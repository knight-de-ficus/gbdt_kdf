# 基于GBDT的网络攻击检测与识别

学术裁缝做的本科毕设...

## 项目简介

梯度提升树是基于提升思想的机器学习算法。课题实现基于梯度提升树的网络攻击检测与识别算法。

已实现效果：

哈夫曼编码+卡方检验特征选择+特征前向选择
权重分布
LightGBM 或 自定义的提升方法

## 用法

结果不咋地，别学，我建议你去隔壁深度学习
（提示：基于transformer的网络攻击检测与识别应该还没人做过）

先使用data前缀的若干代码进行预处理。
预处理的文件最好自己写，我这里代码管理比较混乱。
处理后的数据集应当：

1. 有表头
2. 特征只有整数值、浮点数值和布尔值
3. 标签应当是且仅是最后一列

训练和预测的代码主函数是main.py，运行得到result.csv
main.py调用两个文件：feature_select.py和gbdt_model.py
feature_select.py用于特征选择
gbdt_model.py实现了梯度提升树的提升部分。
树部分使用sklearn，因此需要pip install sklearn

evaluate.py用于计算result.csv的指标
draw.py用于绘制混淆矩阵等图片
compare.py实现了若干其他机器学习，用于对比指标

preprocess.py是早期实现的预处理，比较鸡肋

## 未来可以做的工作

### 本项目的优化

前向选择的优化：前向改成双向，选择特征策略可以优化一下
调参：提高指标

### 项目的完善拓展

软件的封装和图形化
十分训练集的测试
测试的过程继续学习
流量检测

## 字典

kdd_f {'dos': 0, 'normal': 1, 'probe': 2, 'r2l': 3, 'u2r': 4}

unsw_f {'Normal': 0, 'Backdoor': 1, 'Analysis': 2, 'Fuzzers': 3, 'Shellcode': 4, 'Reconnaissance': 5, 'Exploits': 6, 'DoS': 7, 'Worms': 8, 'Generic': 9}

## 结果

这个项目的理论准确度上限在0.9左右

### UNSW-NB15数据集 huffman编码

 Oversampling done.
train_df shape: (325936, 71)
标签分布:
attack_cat
0    56000
9    40000
6    33393
5    28728
4    28330
3    28187
1    28185
8    27974
2    27842
7    27297
Name: count, dtype: int64
round 1 / 4, size: 69
#####################################################################
round 2 / 4, size: 59
###########################################################
round 3 / 4, size: 49
#################################################
round 4 / 4, size: 39
#######################################
前向选择最佳特征: ['3', '23', '4', '8', '24', '1', '20', '2', '52', '14', '6', '41', '29', '44', '31', '30', '46', '47', '39', '16', '53', '25', '35', '26', '17', '42', '43', '45', '21', '28', '40', '15', '48', '36', '12', '64', '7', '11', '13', '18']
特征选择与评估耗时: 2316.43 秒
训练耗时: 6.54 秒
classification_report:
              precision    recall  f1-score   support

           0       0.97      0.71      0.82     37000
           1       0.03      0.18      0.05       583
           2       0.03      0.15      0.05       677
           3       0.30      0.60      0.40      6062
           4       0.20      0.93      0.33       378
           5       0.90      0.82      0.86      3496
           6       0.73      0.67      0.70     11132
           7       0.32      0.24      0.28      4089
           8       0.21      0.77      0.33        44
           9       1.00      0.97      0.98     18871

    accuracy                           0.73     82332
   macro avg       0.47      0.60      0.48     82332
weighted avg       0.84      0.73      0.77     82332

[[26239     4  1728  8107   454     6   409    36    13     4]
 [   52   131    99    38     0     0   115   242     0     0]
 [  585   292   224  3627   433    13   386   491     3     8]
 [    8   191    36     5   107  2861   215    67     3     3]
 [   75  1343   501   235   273   253  7437   929    61    25]
 [    0     0     0     0     2     0     8     0    34     0]
 [    9    18     7    43    41     0   323    78    31 18321]]

### UNSW-NB15数据集 one-hot编码

Oversampling done.
train_df shape: (326740, 197)
标签分布:
attack_cat
0    56000
9    40000
6    33393
5    28781
1    28615
4    28311
3    28197
2    27977
8    27974
7    27492
Name: count, dtype: int64
round 1 / 4, size: 195
###################################################################################################################################################################################################
round 2 / 4, size: 185
#########################################################################################################################################################################################
round 3 / 4, size: 175
###############################################################################################################################################################################
round 4 / 4, size: 165
#####################################################################################################################################################################
前向选择最佳特征: ['sbytes', 'smean', 'dbytes', 'dmean', 'sload', 'spkts', 'dpkts', 'tcprtt', 'service_dns', 'sjit', 'proto_unas', 'proto_udp', 'sttl', 'ct_srv_dst', 'ct_dst_ltm', 'response_body_len', 'ct_dst_sport_ltm', 'ct_src_dport_ltm', 'ct_srv_src', 'ct_state_ttl', 'sloss', 'ct_flw_http_mthd', 
'service_irc', 'service_ftp-data', 'ct_src_ltm', 'proto_sctp', 'service_-', 'swin', 'proto_tcp', 'sinpkt', 'proto_ospf', 'proto_ipv6-frag', 'dttl', 'synack', 'rate', 'dload', 'dloss', 'stcpb', 'dtcpb', 'dwin']
特征选择与评估耗时: 8575.40 秒
训练耗时: 8.17 秒
classification_report:
              precision    recall  f1-score   support

           0       0.97      0.71      0.82     37000
           1       0.05      0.42      0.09       583
           2       0.03      0.15      0.05       677
           3       0.29      0.58      0.39      6062
           4       0.20      0.94      0.34       378
           5       0.90      0.82      0.86      3496
           6       0.76      0.64      0.69     11132
           7       0.34      0.20      0.25      4089
           8       0.22      0.82      0.34        44
           9       1.00      0.97      0.98     18871

    accuracy                           0.72     82332
   macro avg       0.48      0.62      0.48     82332
weighted avg       0.85      0.72      0.77     82332

[[26252     4  1769  8056   449     8   403    35    12    12]
 [    0   244    93     7     9     2    64   164     0     0]
 [   31   289   101     4     0     0    84   168     0     0]
 [  660   557   248  3493   416    20   324   333     3     8]
 [    2     2     0     7   356     1     9     0     1     0]
 [    7   198    63     9   100  2865   189    58     4     3]
 [   77  1698   681   181   279   254  7145   732    66    19]
 [   34  1558   590    44    83    35   903   822    12     8]
 [    0     0     0     0     1     0     7     0    36     0]
 [    9    26    11    41    45     4   322    73    31 18309]]
预测结果已保存到 ./result.csv
